(function(){"use strict";var width=760,height=400,padding=30,empty=true,container="#carveouts",carveout_types=["wind","solar"],parse_date=d3.time.format("%Y").parse;d3.json("/static/js/data/states/"+Options.state+".json",function(_data){var def_line=[{data:[]}],data=[{type:"wind",data:[]},{type:"solar",data:[]}],stored={wind:Options.data.wind||false,solar:Options.data.solar||false};carveout_types.forEach(function(d,i){var carveout_type=carveout_types[i],carveout_data=data.filter(function(e){return e.type===carveout_type})[0],_stored=stored[carveout_type]!==false,carveout=_data.carveouts.filter(function(d){return d.type===carveout_type})[0];carveout=_stored?stored[carveout_type].data:carveout?carveout.data:[];empty=empty?carveout.length===0:d3.sum(carveout,function(d){return d.y})===0;carveout=carveout.length>0?carveout:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];carveout.forEach(function(d,ii){var _t=_data.trajectory[ii];if(_stored&&!Options.data.update_state){carveout_data.data[ii]={x:parse_date(String(ii+_data.start_year)),y:_t===0?0:d.y,type:carveout_type}}else{carveout_data.data[ii]={x:parse_date(String(ii+_data.start_year)),y:_t===0?0:d*100,type:carveout_type}}});Options.data[carveout_type]=carveout_data});data.sort(function(a,b){return a.data[a.data.length-1].y<b.data[b.data.length-1].y?-1:a.data[a.data.length-1].y>b.data[b.data.length-1].y?1:0});var carveouts=(new RPSGraph).padding(30).width(width).height(height).select(container).title("Adjust the state&rsquo;s carveouts").x(d3.time.scale()).y(d3.scale.linear()).domain([new Date(2013,0,1),new Date(2030,0,1)],[0,100]).max_domains([50,100]).format_x(function(x){return x.getFullYear()}).format_y(function(y){return d3.format(".1f")(y)}).data(data).stacked(true).hoverable(true).draggable(true,false).h_grid(true).legend(true).draw();carveouts.zeroes(empty)})})();