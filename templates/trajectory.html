{% extends 'index.html' %}
{% block title %} | {{ state|capitalize }}{% endblock %}
{% block headcss %}<link href="/static/css/main.css" rel="stylesheet">{% endblock %}
{% block left_nav %}
<li><a href data-name="trajectory">Set new trajectory</a></li>
{% endblock %}
{% block content %}
  <article id="main_content">
    <section>
      <header>
        <h1></h1>
        <img src alt>
      </header>
    </section>
    <section class="clearfix">
      <h2>Trajectory</h2>
      <div id="trajectory" class="module clearfix">
      </div>
    </section>
  </article>
{% endblock %}
{% block bodyjs %}
  <script>
    Options = window.Options || {};
    Options.state = '{{ state }}';
    Options.graph_type = '{{ graph_type }}';
  </script>
  <script src="/static/js/vendor/d3.v3.min.js" charset="utf-8"></script>
  <script src="/static/js/graphs/stacked_chart.js"></script>
  <script>
    var width = 730,
        height = 300,
        padding = 30,
        parse_date = d3.time.format('%Y').parse;
    d3.json('/static/js/state_data.json', function(_data) {
      _s = _data.features.filter(function(d) {
        return (d.properties.machine_name == Options.state) ? d : null;
      })[0];
      _data = [{type: 'rps', data: []}]
      _s.properties.trajectory.forEach(function(d, i) {
        _data[0].data[i] = {y: d * 100, x: parse_date(String(i + 2000)), y0: 0};
      });
      var def_line = [{data: []}];
      _s.properties.trajectory.forEach(function(d, i) {
        def_line[0].data[i] = {y: d * 100, x: parse_date(String(i + 2000)), y0: 0};
      });
{#      d3.select('#trajectory').style('width', width + 'px').style('height', height + 'px');#}
      var foo = new RPSGraph()
        .padding(30)
        .width(width).height(height)
        .select('#trajectory')
          .title('Adjust the state\'s trajectory')
        .x(d3.time.scale())
        .y(d3.scale.linear())
        .domain([new Date(2013, 0, 1), new Date(2030, 0, 1)], [0, 100])
        .max_domains([50, 100])
        .format_x(function(x) { return x.getFullYear(); })
        .format_y(function(y) { return d3.format('.1f')(y); })
        .data(_data)
        .stacked(false)
        .hoverable(true)
        .draggable(true, false)
{#        .ghost(_s.properties.trajectory)#}
        .default_line(def_line)
{#        .colors(['#f00'])#}
        .h_grid(true)
        .draw();
    });
  </script>
{% endblock %}